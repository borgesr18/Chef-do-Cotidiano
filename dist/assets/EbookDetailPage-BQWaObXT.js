import{j as e}from"./ui-vendor-CCxVMQ9B.js";import{h as b,r as a}from"./react-vendor-CN1YoO9o.js";import{C as N,b as v,c as y,a as w}from"./card-DDJFiqOK.js";import{f as k,B as C,L as E,h as _,u as d}from"./index-DStP_-PY.js";import{B as L}from"./badge-B80lkMBr.js";import{u as S}from"./useEbookPurchase-DtVjs3Bb.js";import{S as B}from"./SEO-BV2VGWhT.js";import{L as P}from"./LazyImage-BTHAI7S6.js";import"./supabase-vendor-CqT5vMLU.js";import"./utils-vendor-BTGVH9Kg.js";const H=()=>{const{id:r}=b(),[s,i]=a.useState(null),[m,o]=a.useState(!0),{createPurchase:u,hasPurchased:x}=S(),{isAuthenticated:f}=k(),[h,n]=a.useState(!1),[p,l]=a.useState(!1);a.useEffect(()=>{(async()=>{try{o(!0);const{data:c}=await _.getById(r);i(c);const t=await x(r);t!=null&&t.data&&l(!0)}catch{i(null)}finally{o(!1)}})()},[r]);const j=async()=>{if(!f){n(!0);return}(await u(r,{method:"stripe",amount:(s==null?void 0:s.price)||0,transactionId:`temp_${Date.now()}`})).data?(d.success("Compra realizada com sucesso!"),l(!0)):d.error("Erro ao processar compra")};return m?e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):s?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(B,{title:`${s.title} - E-book`,description:s.description,image:s.cover_image}),e.jsx("section",{className:"py-12",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsx(P,{src:s.cover_image,alt:s.title,className:"w-full rounded-lg"})}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs(N,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(y,{className:"text-3xl",children:s.title}),e.jsxs(L,{className:"bg-green-600 text-white",children:["R$ ",Number(s.price||0).toFixed(2)]})]})}),e.jsxs(w,{children:[e.jsx("p",{className:"text-muted-foreground mb-6",children:s.description}),e.jsxs("div",{className:"flex gap-3",children:[p&&s.file_url?e.jsx("a",{className:"inline-flex items-center px-4 py-2 border rounded-md",href:s.file_url,target:"_blank",rel:"noreferrer",children:"Baixar e-book"}):e.jsx(C,{onClick:j,children:"Comprar agora"}),s.file_url&&e.jsx("a",{className:"inline-flex items-center px-4 py-2 border rounded-md",href:s.file_url,target:"_blank",rel:"noreferrer",children:"Visualizar amostra"})]})]})]})})]})})}),e.jsx(E,{isOpen:h,onClose:()=>n(!1)})]}):e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"E-book n√£o encontrado"}),e.jsx("p",{className:"text-muted-foreground",children:"Verifique o link e tente novamente."})]})};export{H as EbookDetailPage,H as default};
