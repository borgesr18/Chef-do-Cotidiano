import{j as e}from"./ui-vendor-CCxVMQ9B.js";import{r as i}from"./react-vendor-CN1YoO9o.js";import{i as O,B as o,I as x,D as w,v as D,w as S,x as _,o as l,z as T,y as P,s as p,u as h}from"./index-DStP_-PY.js";import{C as R,b as G,a as $}from"./card-DDJFiqOK.js";import{T as J}from"./textarea-CbJGJkAv.js";import{S as K}from"./switch-B7D-GGZN.js";import{T as M,a as Q,b as E,c,d as U,e as n}from"./table-CZG2d7nx.js";import{P as V}from"./plus-B7lLGJlf.js";import{S as W}from"./search-DyISHBFt.js";import{S as X}from"./square-pen--POmUCjf.js";import{T as Y}from"./trash-2-Db9KMxbd.js";import"./supabase-vendor-CqT5vMLU.js";import"./utils-vendor-BTGVH9Kg.js";const xe=()=>{var b;const[F,f]=i.useState([]),[k,v]=i.useState(!0),[C,z]=i.useState(""),[d,m]=i.useState({open:!1,category:null}),[g,u]=i.useState({open:!1,category:null}),[a,t]=i.useState({name:"",slug:"",description:"",icon:"",color:"#3B82F6",sort_order:0,is_active:!0});i.useEffect(()=>{N()},[]);const N=async()=>{try{v(!0);const{data:s,error:r}=await O.getAllForAdmin();if(r)throw r;f(s||[])}catch(s){console.error("Error fetching categories:",s)}finally{v(!1)}},A=async s=>{s.preventDefault();try{if(d.category){const{error:r}=await p.from("categories").update(a).eq("id",d.category.id);if(r)throw r;h.success("Categoria atualizada com sucesso!")}else{const{error:r}=await p.from("categories").insert([a]);if(r)throw r;h.success("Categoria criada com sucesso!")}await N(),m({open:!1,category:null}),y()}catch(r){console.error("Error saving category:",r),h.error("Erro ao salvar categoria")}},B=s=>{t({name:s.name,slug:s.slug,description:s.description||"",icon:s.icon||"",color:s.color||"#3B82F6",sort_order:s.sort_order||0,is_active:s.is_active}),m({open:!0,category:s})},L=async s=>{try{const{error:r}=await p.from("categories").delete().eq("id",s.id);if(r)throw r;f(j=>j.filter(I=>I.id!==s.id)),u({open:!1,category:null}),h.success("Categoria excluída com sucesso!")}catch(r){console.error("Error deleting category:",r),h.error("Erro ao excluir categoria")}},y=()=>{t({name:"",slug:"",description:"",icon:"",color:"#3B82F6",sort_order:0,is_active:!0})},q=s=>s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),H=F.filter(s=>s.name.toLowerCase().includes(C.toLowerCase()));return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gerenciar Categorias"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Administre as categorias de receitas"})]}),e.jsxs(o,{onClick:()=>m({open:!0,category:null}),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Nova Categoria"]})]}),e.jsxs(R,{children:[e.jsx(G,{children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(x,{placeholder:"Buscar categorias...",value:C,onChange:s=>z(s.target.value),className:"pl-10"})]})}),e.jsx($,{children:k?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs(M,{children:[e.jsx(Q,{children:e.jsxs(E,{children:[e.jsx(c,{children:"Nome"}),e.jsx(c,{children:"Slug"}),e.jsx(c,{children:"Descrição"}),e.jsx(c,{children:"Ordem"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Ações"})]})}),e.jsx(U,{children:H.map(s=>e.jsxs(E,{children:[e.jsx(n,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:s.color}}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx(n,{className:"font-mono text-sm",children:s.slug}),e.jsx(n,{className:"max-w-xs truncate",children:s.description||"Sem descrição"}),e.jsx(n,{children:s.sort_order}),e.jsx(n,{children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.is_active?"Ativo":"Inativo"})}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>B(s),children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>u({open:!0,category:s}),className:"text-red-600 hover:text-red-700",children:e.jsx(Y,{className:"h-4 w-4"})})]})})]},s.id))})]})})]}),e.jsx(w,{open:d.open,onOpenChange:s=>{m({open:s,category:null}),s||y()},children:e.jsxs(D,{className:"max-w-md",children:[e.jsx(S,{children:e.jsx(_,{children:d.category?"Editar Categoria":"Nova Categoria"})}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",children:"Nome"}),e.jsx(x,{id:"name",value:a.name,onChange:s=>{const r=s.target.value;t(j=>({...j,name:r,slug:q(r)}))},required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"slug",children:"Slug"}),e.jsx(x,{id:"slug",value:a.slug,onChange:s=>t(r=>({...r,slug:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"description",children:"Descrição"}),e.jsx(J,{id:"description",value:a.description,onChange:s=>t(r=>({...r,description:s.target.value})),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"color",children:"Cor"}),e.jsx(x,{id:"color",type:"color",value:a.color,onChange:s=>t(r=>({...r,color:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"sort_order",children:"Ordem"}),e.jsx(x,{id:"sort_order",type:"number",value:a.sort_order,onChange:s=>t(r=>({...r,sort_order:parseInt(s.target.value)}))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{id:"is_active",checked:a.is_active,onCheckedChange:s=>t(r=>({...r,is_active:s}))}),e.jsx(l,{htmlFor:"is_active",children:"Categoria ativa"})]}),e.jsxs(T,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>m({open:!1,category:null}),children:"Cancelar"}),e.jsx(o,{type:"submit",children:d.category?"Atualizar":"Criar"})]})]})]})}),e.jsx(w,{open:g.open,onOpenChange:s=>u({open:s,category:null}),children:e.jsxs(D,{children:[e.jsxs(S,{children:[e.jsx(_,{children:"Confirmar Exclusão"}),e.jsxs(P,{children:['Tem certeza que deseja excluir a categoria "',(b=g.category)==null?void 0:b.name,'"? Esta ação não pode ser desfeita.']})]}),e.jsxs(T,{children:[e.jsx(o,{variant:"outline",onClick:()=>u({open:!1,category:null}),children:"Cancelar"}),e.jsx(o,{variant:"destructive",onClick:()=>L(g.category),children:"Excluir"})]})]})})]})};export{xe as CategoriesAdmin};
