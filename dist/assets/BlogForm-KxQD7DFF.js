import{j as e}from"./ui-vendor-CCxVMQ9B.js";import{u as O,h as z,r as h}from"./react-vendor-CN1YoO9o.js";import{i as H,e as b,B as y,o as i,I as n,X as K,u as E,g as X,s as D}from"./index-DStP_-PY.js";import{C as g,b as m,c as u,a as x}from"./card-DDJFiqOK.js";import{T as j}from"./textarea-CbJGJkAv.js";import{S as F,a as I,b as P,c as T,d as f}from"./select-atrVVbAC.js";import{B as G}from"./badge-B80lkMBr.js";import{A as J}from"./arrow-left-Q-Bd-7NB.js";import"./supabase-vendor-CqT5vMLU.js";import"./utils-vendor-BTGVH9Kg.js";const le=()=>{const v=O(),{id:p}=z(),l=!!p,[_,d]=h.useState(!1),[q,B]=h.useState([]),[C,N]=h.useState(""),[t,c]=h.useState({title:"",slug:"",content:"",excerpt:"",status:"draft",category_id:"",featured_image:"",tags:[],meta_description:"",og_title:"",og_description:"",published_at:""});h.useEffect(()=>{L(),l&&k()},[p]);const L=async()=>{try{const{data:a}=await H.getAll();B(a||[])}catch(a){console.error("Error fetching categories:",a)}},k=async()=>{try{d(!0);const{data:a,error:s}=await b.getById(p);if(s)throw s;a&&c({title:a.title||"",slug:a.slug||"",content:a.content||"",excerpt:a.excerpt||"",status:a.status||"draft",category_id:a.category_id||"",featured_image:a.featured_image||"",tags:a.tags||[],meta_description:a.meta_description||"",og_title:a.og_title||"",og_description:a.og_description||"",published_at:a.published_at?new Date(a.published_at).toISOString().slice(0,16):""})}catch(a){console.error("Error fetching post:",a)}finally{d(!1)}},o=(a,s)=>{c(r=>({...r,[a]:s})),a==="title"&&!l&&c(r=>({...r,slug:X(s),og_title:s})),a==="excerpt"&&c(r=>({...r,meta_description:s,og_description:s}))},A=a=>{if(a.key==="Enter"||a.key===","){a.preventDefault();const s=C.trim().toLowerCase();s&&!t.tags.includes(s)&&c(r=>({...r,tags:[...r.tags,s]})),N("")}},R=a=>{c(s=>({...s,tags:s.tags.filter(r=>r!==a)}))},U=async a=>{const s=a.target.files[0];if(s)try{d(!0);const r=s.name.split(".").pop(),w=`blog/${`${Date.now()}.${r}`}`,{error:S}=await D.storage.from("images").upload(w,s);if(S)throw S;const{data:{publicUrl:$}}=D.storage.from("images").getPublicUrl(w);c(M=>({...M,featured_image:$}))}catch(r){console.error("Error uploading image:",r)}finally{d(!1)}},V=async a=>{a.preventDefault();try{d(!0);const s={...t,published_at:t.published_at?new Date(t.published_at).toISOString():null};let r;if(l?r=await b.update(p,s):r=await b.create(s),r.error)throw r.error;E.success(`Post ${l?"atualizado":"criado"} com sucesso!`),v("/admin/blog")}catch(s){console.error("Error saving post:",s),E.error("Erro ao salvar post")}finally{d(!1)}};return _&&l?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs(y,{variant:"ghost",onClick:()=>v("/admin/blog"),className:"mr-4",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Voltar"]}),e.jsx("h1",{className:"text-3xl font-bold",children:l?"Editar Post":"Novo Post"})]}),e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(m,{children:e.jsx(u,{children:"Informações Básicas"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"title",children:"Título *"}),e.jsx(n,{id:"title",value:t.title,onChange:a=>o("title",a.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"slug",children:"Slug"}),e.jsx(n,{id:"slug",value:t.slug,onChange:a=>o("slug",a.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"excerpt",children:"Resumo *"}),e.jsx(j,{id:"excerpt",value:t.excerpt,onChange:a=>o("excerpt",a.target.value),rows:3,placeholder:"Breve descrição do post...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"category",children:"Categoria"}),e.jsxs(F,{value:t.category_id,onValueChange:a=>o("category_id",a),children:[e.jsx(I,{children:e.jsx(P,{placeholder:"Selecione uma categoria"})}),e.jsx(T,{children:q.map(a=>e.jsx(f,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"status",children:"Status"}),e.jsxs(F,{value:t.status,onValueChange:a=>o("status",a),children:[e.jsx(I,{children:e.jsx(P,{})}),e.jsxs(T,{children:[e.jsx(f,{value:"draft",children:"Rascunho"}),e.jsx(f,{value:"published",children:"Publicado"}),e.jsx(f,{value:"archived",children:"Arquivado"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"published_at",children:"Data de Publicação"}),e.jsx(n,{id:"published_at",type:"datetime-local",value:t.published_at,onChange:a=>o("published_at",a.target.value)})]})]})]})]}),e.jsxs(g,{children:[e.jsx(m,{children:e.jsx(u,{children:"Conteúdo"})}),e.jsx(x,{children:e.jsxs("div",{children:[e.jsx(i,{htmlFor:"content",children:"Conteúdo do Post *"}),e.jsx(j,{id:"content",value:t.content,onChange:a=>o("content",a.target.value),rows:15,placeholder:"Escreva o conteúdo do post em Markdown...",className:"font-mono",required:!0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Você pode usar Markdown para formatar o texto (ex: **negrito**, *itálico*, # Título)"})]})})]}),e.jsxs(g,{children:[e.jsx(m,{children:e.jsx(u,{children:"Imagem em Destaque"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"image-upload",children:"Upload de Imagem"}),e.jsx(n,{id:"image-upload",type:"file",accept:"image/*",onChange:U,className:"cursor-pointer"})]}),t.featured_image&&e.jsx("div",{children:e.jsx("img",{src:t.featured_image,alt:"Preview",className:"w-32 h-32 object-cover rounded-lg"})}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"image-url",children:"URL da Imagem"}),e.jsx(n,{id:"image-url",value:t.featured_image,onChange:a=>o("featured_image",a.target.value),placeholder:"https://exemplo.com/imagem.jpg"})]})]})})]}),e.jsxs(g,{children:[e.jsx(m,{children:e.jsx(u,{children:"Tags"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"tags",children:"Adicionar Tags"}),e.jsx(n,{id:"tags",value:C,onChange:a=>N(a.target.value),onKeyDown:A,placeholder:"Digite uma tag e pressione Enter ou vírgula"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Pressione Enter ou vírgula para adicionar uma tag"})]}),t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map((a,s)=>e.jsxs(G,{variant:"secondary",className:"flex items-center gap-1",children:[a,e.jsx("button",{type:"button",onClick:()=>R(a),className:"ml-1 hover:text-red-500",children:e.jsx(K,{className:"h-3 w-3"})})]},s))})]})})]}),e.jsxs(g,{children:[e.jsx(m,{children:e.jsx(u,{children:"SEO e Redes Sociais"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"meta_description",children:"Meta Description"}),e.jsx(j,{id:"meta_description",value:t.meta_description,onChange:a=>o("meta_description",a.target.value),rows:2,placeholder:"Descrição para mecanismos de busca (máx. 160 caracteres)",maxLength:160}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[t.meta_description.length,"/160 caracteres"]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"og_title",children:"Título para Redes Sociais"}),e.jsx(n,{id:"og_title",value:t.og_title,onChange:a=>o("og_title",a.target.value),placeholder:"Título que aparecerá quando compartilhado"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"og_description",children:"Descrição para Redes Sociais"}),e.jsx(j,{id:"og_description",value:t.og_description,onChange:a=>o("og_description",a.target.value),rows:2,placeholder:"Descrição que aparecerá quando compartilhado"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>v("/admin/blog"),children:"Cancelar"}),e.jsxs(y,{type:"submit",disabled:_,children:[_?"Salvando...":l?"Atualizar":"Criar"," Post"]})]})]})]})};export{le as BlogForm};
