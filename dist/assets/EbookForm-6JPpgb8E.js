import{j as e}from"./ui-vendor-CCxVMQ9B.js";import{u as A,h as I,r as n}from"./react-vendor-CN1YoO9o.js";import{C as R,b as T,c as $,a as D}from"./card-DDJFiqOK.js";import{b as B,B as v,o as l,I as o,i as V,h,g as q,s as f}from"./index-DStP_-PY.js";import{T as H}from"./textarea-CbJGJkAv.js";import{S as b,a as y,b as C,c as N,d as u}from"./select-atrVVbAC.js";import{A as M}from"./arrow-left-Q-Bd-7NB.js";import"./supabase-vendor-CqT5vMLU.js";import"./utils-vendor-BTGVH9Kg.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=B("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ee=()=>{const m=A(),{id:c}=I(),d=!!c,[r,g]=n.useState({title:"",slug:"",description:"",price:"",pages:"",cover_image:"",file_url:"",status:"draft",category_id:null}),[S,_]=n.useState([]),[p,x]=n.useState(!1),[w,k]=n.useState(!0);n.useEffect(()=>{(async()=>{const{data:t}=await V.getAllForAdmin();if(_(t||[]),d){const{data:a}=await h.getById(c);a&&g({title:a.title||"",slug:a.slug||"",description:a.description||"",price:a.price||"",pages:a.pages||"",cover_image:a.cover_image||"",file_url:a.file_url||"",status:a.status||"draft",category_id:a.category_id||null})}k(!1)})()},[c,d]);const i=(s,t)=>{g(a=>({...a,[s]:t}))},E=s=>{i("title",s),i("slug",q(s))},F=async s=>{if(!s)return;const t=s.name.split(".").pop(),j=`ebooks/${`${Date.now()}-${Math.random().toString(36).substring(2)}.${t}`}`,{error:L}=await f.storage.from("images").upload(j,s);if(!L){const{data:{publicUrl:P}}=f.storage.from("images").getPublicUrl(j);i("cover_image",P)}},U=async s=>{s.preventDefault(),x(!0);try{const t={...r,price:Number(r.price||0),pages:r.pages?Number(r.pages):null};if(d){const{error:a}=await h.update(c,t);if(a)throw a}else{const{error:a}=await h.create(t);if(a)throw a}m("/admin/ebooks")}catch(t){console.error("Erro ao salvar e-book:",t)}finally{x(!1)}};return w?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"p-6 max-w-4xl",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{variant:"outline",onClick:()=>m(-1),children:[e.jsx(M,{className:"w-4 h-4 mr-2"})," Voltar"]}),e.jsx("h1",{className:"text-2xl font-bold",children:d?"Editar E-book":"Novo E-book"})]})}),e.jsxs(R,{children:[e.jsx(T,{children:e.jsx($,{children:"Informações do E-book"})}),e.jsx(D,{children:e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"title",children:"Título"}),e.jsx(o,{id:"title",value:r.title,onChange:s=>E(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"slug",children:"Slug"}),e.jsx(o,{id:"slug",value:r.slug,onChange:s=>i("slug",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"price",children:"Preço (R$)"}),e.jsx(o,{id:"price",type:"number",step:"0.01",value:r.price,onChange:s=>i("price",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"pages",children:"Páginas"}),e.jsx(o,{id:"pages",type:"number",value:r.pages,onChange:s=>i("pages",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"category",children:"Categoria"}),e.jsxs(b,{value:r.category_id||"",onValueChange:s=>i("category_id",s),children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Selecione uma categoria"})}),e.jsx(N,{children:S.map(s=>e.jsx(u,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"status",children:"Status"}),e.jsxs(b,{value:r.status,onValueChange:s=>i("status",s),children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Selecione o status"})}),e.jsxs(N,{children:[e.jsx(u,{value:"draft",children:"Rascunho"}),e.jsx(u,{value:"published",children:"Publicado"}),e.jsx(u,{value:"archived",children:"Arquivado"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"description",children:"Descrição"}),e.jsx(H,{id:"description",rows:5,value:r.description,onChange:s=>i("description",s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-end",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"cover",children:"Capa"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{id:"cover",placeholder:"URL da imagem",value:r.cover_image,onChange:s=>i("cover_image",s.target.value)}),e.jsxs("label",{className:"inline-flex items-center px-3 py-2 border rounded-md cursor-pointer",children:[e.jsx(z,{className:"w-4 h-4 mr-2"})," Upload",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:s=>F(s.target.files[0])})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"file_url",children:"Arquivo (URL)"}),e.jsx(o,{id:"file_url",placeholder:"URL do PDF",value:r.file_url,onChange:s=>i("file_url",s.target.value)})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{type:"submit",disabled:p,children:p?"Salvando...":"Salvar E-book"})})]})})]})]})};export{ee as EbookForm,ee as default};
