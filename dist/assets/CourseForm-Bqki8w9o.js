import{j as e}from"./ui-vendor-CCxVMQ9B.js";import{r as f,u as ie,h as le}from"./react-vendor-CN1YoO9o.js";import{b as ce,i as ne,d as A,B as v,o as n,I as j,u as B,g as oe,s as U}from"./index-DStP_-PY.js";import{C as S,b as E,c as L,a as k}from"./card-DDJFiqOK.js";import{T as F}from"./textarea-CbJGJkAv.js";import{S as z,a as P,b as T,c as $,d as _}from"./select-atrVVbAC.js";import{B as O}from"./badge-B80lkMBr.js";import{A as de}from"./arrow-left-Q-Bd-7NB.js";import{P as V}from"./plus-B7lLGJlf.js";import{T as R}from"./trash-2-Db9KMxbd.js";import"./supabase-vendor-CqT5vMLU.js";import"./utils-vendor-BTGVH9Kg.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=ce("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),J=f.createContext({}),ue=()=>{const u=f.useContext(J);if(!u)throw new Error("useDragDrop must be used within a DragDropProvider");return u},he=({children:u})=>{const[h,d]=f.useState(null),[y,m]=f.useState(null),C=(p,o)=>{d({...p,type:o})},b=()=>{d(null),m(null)},M={draggedItem:h,dropTarget:y,setDropTarget:m,handleDragStart:C,handleDragEnd:b,handleDragOver:p=>{p.preventDefault()},handleDrop:(p,o)=>{h&&p&&h.id!==p.id&&o(h,p),b()}};return e.jsx(J.Provider,{value:M,children:u})},G=({item:u,type:h,children:d,onReorder:y,className:m=""})=>{const{handleDragStart:C,handleDragEnd:b,handleDragOver:l,handleDrop:c}=ue();return e.jsx("div",{draggable:!0,onDragStart:()=>C(u,h),onDragEnd:b,onDragOver:l,onDrop:()=>c(u,y),className:`cursor-move ${m}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:d})]})})},Ne=()=>{const u=ie(),{id:h}=le(),d=!!h,[y,m]=f.useState(!1),[C,b]=f.useState([]),[l,c]=f.useState({title:"",slug:"",description:"",level:"beginner",status:"draft",price:"",category_id:"",featured_image:"",what_you_learn:[""],target_audience:"",modules:[]});f.useEffect(()=>{M(),d&&p()},[h]);const M=async()=>{try{const{data:s}=await ne.getAll();b(s||[])}catch(s){console.error("Error fetching categories:",s)}},p=async()=>{var s;try{m(!0);const{data:r,error:a}=await A.getById(h);if(a)throw a;r&&c({title:r.title||"",slug:r.slug||"",description:r.description||"",level:r.level||"beginner",status:r.status||"draft",price:((s=r.price)==null?void 0:s.toString())||"",category_id:r.category_id||"",featured_image:r.featured_image||"",what_you_learn:r.what_you_learn||[""],target_audience:r.target_audience||"",modules:r.modules||[]})}catch(r){console.error("Error fetching course:",r)}finally{m(!1)}},o=(s,r)=>{c(a=>({...a,[s]:r})),s==="title"&&!d&&c(a=>({...a,slug:oe(r)}))},K=(s,r)=>{const a=[...l.what_you_learn];a[s]=r,c(t=>({...t,what_you_learn:a}))},Q=()=>{c(s=>({...s,what_you_learn:[...s.what_you_learn,""]}))},W=s=>{l.what_you_learn.length>1&&c(r=>({...r,what_you_learn:r.what_you_learn.filter((a,t)=>t!==s)}))},X=()=>{const s={id:Date.now(),title:"",description:"",sort_order:l.modules.length,lessons:[]};c(r=>({...r,modules:[...r.modules,s]}))},q=(s,r,a)=>{const t=[...l.modules];t[s]={...t[s],[r]:a},c(i=>({...i,modules:t}))},Y=s=>{c(r=>({...r,modules:r.modules.filter((a,t)=>t!==s)}))},Z=s=>{const r={id:Date.now(),title:"",description:"",video_url:"",duration_minutes:"",is_preview:!1,sort_order:l.modules[s].lessons.length},a=[...l.modules];a[s].lessons.push(r),c(t=>({...t,modules:a}))},N=(s,r,a,t)=>{const i=[...l.modules];i[s].lessons[r]={...i[s].lessons[r],[a]:t},c(x=>({...x,modules:i}))},I=(s,r)=>{const a=[...l.modules];a[s].lessons=a[s].lessons.filter((t,i)=>i!==r),c(t=>({...t,modules:a}))},ee=(s,r)=>{const a=[...l.modules],t=a.findIndex(g=>g.id===s.id),i=a.findIndex(g=>g.id===r.id),[x]=a.splice(t,1);a.splice(i,0,x),a.forEach((g,D)=>{g.sort_order=D}),c(g=>({...g,modules:a}))},se=(s,r,a)=>{const t=[...l.modules],i=t[s].lessons,x=i.findIndex(w=>w.id===r.id),g=i.findIndex(w=>w.id===a.id),[D]=i.splice(x,1);i.splice(g,0,D),i.forEach((w,te)=>{w.sort_order=te}),c(w=>({...w,modules:t}))},re=async s=>{const r=s.target.files[0];if(r)try{m(!0);const a=r.name.split(".").pop(),i=`courses/${`${Date.now()}.${a}`}`,{error:x}=await U.storage.from("images").upload(i,r);if(x)throw x;const{data:{publicUrl:g}}=U.storage.from("images").getPublicUrl(i);c(D=>({...D,featured_image:g}))}catch(a){console.error("Error uploading image:",a)}finally{m(!1)}},ae=async s=>{s.preventDefault();try{m(!0);const r={...l,price:parseFloat(l.price)||0};let a;if(d?a=await A.update(h,r):a=await A.create(r),a.error)throw a.error;B.success(d?"Curso atualizado com sucesso!":"Curso criado com sucesso!"),u("/admin/courses")}catch(r){console.error("Error saving course:",r),B.error("Erro ao salvar curso")}finally{m(!1)}};return y&&d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs(v,{variant:"ghost",onClick:()=>u("/admin/courses"),className:"mr-4",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Voltar"]}),e.jsx("h1",{className:"text-3xl font-bold",children:d?"Editar Curso":"Novo Curso"})]}),e.jsx(he,{children:e.jsxs("form",{onSubmit:ae,className:"space-y-6",children:[e.jsxs(S,{children:[e.jsx(E,{children:e.jsx(L,{children:"Informações Básicas"})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"title",children:"Título *"}),e.jsx(j,{id:"title",value:l.title,onChange:s=>o("title",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"slug",children:"Slug"}),e.jsx(j,{id:"slug",value:l.slug,onChange:s=>o("slug",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"Descrição *"}),e.jsx(F,{id:"description",value:l.description,onChange:s=>o("description",s.target.value),rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"level",children:"Nível"}),e.jsxs(z,{value:l.level,onValueChange:s=>o("level",s),children:[e.jsx(P,{children:e.jsx(T,{})}),e.jsxs($,{children:[e.jsx(_,{value:"beginner",children:"Iniciante"}),e.jsx(_,{value:"intermediate",children:"Intermediário"}),e.jsx(_,{value:"advanced",children:"Avançado"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"price",children:"Preço (R$)"}),e.jsx(j,{id:"price",type:"number",step:"0.01",value:l.price,onChange:s=>o("price",s.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"category",children:"Categoria"}),e.jsxs(z,{value:l.category_id,onValueChange:s=>o("category_id",s),children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Selecione uma categoria"})}),e.jsx($,{children:C.map(s=>e.jsx(_,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"status",children:"Status"}),e.jsxs(z,{value:l.status,onValueChange:s=>o("status",s),children:[e.jsx(P,{children:e.jsx(T,{})}),e.jsxs($,{children:[e.jsx(_,{value:"draft",children:"Rascunho"}),e.jsx(_,{value:"published",children:"Publicado"}),e.jsx(_,{value:"archived",children:"Arquivado"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"target_audience",children:"Público-alvo"}),e.jsx(F,{id:"target_audience",value:l.target_audience,onChange:s=>o("target_audience",s.target.value),rows:2,placeholder:"Para quem é este curso?"})]})]})]}),e.jsxs(S,{children:[e.jsx(E,{children:e.jsx(L,{children:"Imagem em Destaque"})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"image-upload",children:"Upload de Imagem"}),e.jsx(j,{id:"image-upload",type:"file",accept:"image/*",onChange:re,className:"cursor-pointer"})]}),l.featured_image&&e.jsx("div",{children:e.jsx("img",{src:l.featured_image,alt:"Preview",className:"w-32 h-32 object-cover rounded-lg"})}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"image-url",children:"URL da Imagem"}),e.jsx(j,{id:"image-url",value:l.featured_image,onChange:s=>o("featured_image",s.target.value),placeholder:"https://exemplo.com/imagem.jpg"})]})]})})]}),e.jsxs(S,{children:[e.jsx(E,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(L,{children:"O que você vai aprender"}),e.jsxs(v,{type:"button",onClick:Q,size:"sm",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Adicionar"]})]})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-3",children:l.what_you_learn.map((s,r)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(j,{value:s,onChange:a=>K(r,a.target.value),placeholder:"Ex: Técnicas básicas de corte",className:"flex-1"}),e.jsx(v,{type:"button",variant:"ghost",size:"sm",onClick:()=>W(r),disabled:l.what_you_learn.length===1,children:e.jsx(R,{className:"h-4 w-4"})})]},r))})})]}),e.jsxs(S,{children:[e.jsx(E,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(L,{children:"Módulos do Curso"}),e.jsxs(v,{type:"button",onClick:X,size:"sm",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Adicionar Módulo"]})]})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-6",children:l.modules.map((s,r)=>e.jsx(G,{item:s,type:"module",onReorder:ee,children:e.jsxs(S,{className:"border-l-4 border-l-primary",children:[e.jsx(E,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-gray-400"}),e.jsxs(O,{variant:"outline",children:["Módulo ",r+1]})]}),e.jsx(v,{type:"button",variant:"ghost",size:"sm",onClick:()=>Y(r),children:e.jsx(R,{className:"h-4 w-4"})})]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Título do Módulo"}),e.jsx(j,{value:s.title,onChange:a=>q(r,"title",a.target.value),placeholder:"Ex: Fundamentos da Culinária"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Descrição"}),e.jsx(F,{value:s.description,onChange:a=>q(r,"description",a.target.value),rows:2,placeholder:"Descrição do módulo..."})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"font-medium",children:"Aulas"}),e.jsxs(v,{type:"button",onClick:()=>Z(r),size:"sm",variant:"outline",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Adicionar Aula"]})]}),e.jsx("div",{className:"space-y-3",children:s.lessons.map((a,t)=>e.jsx(G,{item:a,type:"lesson",onReorder:(i,x)=>se(r,i,x),children:e.jsxs("div",{className:"border rounded-lg p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(O,{variant:"secondary",size:"sm",children:["Aula ",t+1]}),e.jsx(v,{type:"button",variant:"ghost",size:"sm",onClick:()=>I(r,t),children:e.jsx(R,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Título da Aula"}),e.jsx(j,{value:a.title,onChange:i=>N(r,t,"title",i.target.value),placeholder:"Título da aula",size:"sm"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Duração (min)"}),e.jsx(j,{type:"number",value:a.duration_minutes,onChange:i=>N(r,t,"duration_minutes",i.target.value),placeholder:"30",size:"sm"})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(n,{children:"URL do Vídeo"}),e.jsx(j,{value:a.video_url,onChange:i=>N(r,t,"video_url",i.target.value),placeholder:"https://youtube.com/watch?v=...",size:"sm"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(n,{children:"Descrição"}),e.jsx(F,{value:a.description,onChange:i=>N(r,t,"description",i.target.value),rows:2,placeholder:"Descrição da aula..."})]}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`preview-${r}-${t}`,checked:a.is_preview,onChange:i=>N(r,t,"is_preview",i.target.checked)}),e.jsx(n,{htmlFor:`preview-${r}-${t}`,children:"Aula gratuita (preview)"})]})]})},a.id))})]})]})]})},s.id))})})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>u("/admin/courses"),children:"Cancelar"}),e.jsxs(v,{type:"submit",disabled:y,children:[y?"Salvando...":d?"Atualizar":"Criar"," Curso"]})]})]})})]})};export{Ne as CourseForm};
