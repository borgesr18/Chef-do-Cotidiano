import{j as e}from"./ui-vendor-CCxVMQ9B.js";import{r,L as T}from"./react-vendor-CN1YoO9o.js";import{C as B,b as O,c as F,a as z}from"./card-DDJFiqOK.js";import{f as I,h as M,B as n,I as D,a as R,L as A,u as x}from"./index-DStP_-PY.js";import{B as j}from"./badge-B80lkMBr.js";import{S as $,a as V,b as q,c as G,d as b}from"./select-atrVVbAC.js";import{u as H}from"./useCategories-7MF5cVH2.js";import{u as J}from"./useEbookPurchase-DtVjs3Bb.js";import{S as Z}from"./SEO-BV2VGWhT.js";import{L as K}from"./LazyImage-BTHAI7S6.js";import{S as Q}from"./star-BCJjEaYq.js";import{F as N}from"./file-text-DPQ1k72S.js";import"./supabase-vendor-CqT5vMLU.js";import"./utils-vendor-BTGVH9Kg.js";const de=()=>{const[i,d]=r.useState([]),[v,u]=r.useState(!0),[m,w]=r.useState(""),[l,C]=r.useState(""),{categories:y}=H(),{createPurchase:k,hasPurchased:S}=J(),{isAuthenticated:h}=I(),[E,p]=r.useState(!1),[L,f]=r.useState({}),g=[{id:"1",title:"Guia Completo do Churrasco",description:"Tudo o que você precisa saber para dominar o churrasco em casa.",cover_image:"https://images.unsplash.com/photo-1529193591184-b1d58069ecdd?w=400&h=300&fit=crop",price:49.9,pages:120,rating:4.8,author_name:"Chef Rodrigo",category_name:"Carnes",status:"published"},{id:"2",title:"Massas Caseiras do Zero",description:"Aprenda a fazer massas artesanais com técnicas profissionais.",cover_image:"https://images.unsplash.com/photo-1621996346565-e3dbc353d2e5?w=400&h=300&fit=crop",price:39.9,pages:95,rating:4.7,author_name:"Chef Rodrigo",category_name:"Massas",status:"published"}];r.useEffect(()=>{_()},[]);const _=async()=>{try{u(!0);const{data:s,error:a}=await M.getPublished();a||!s||s.length===0?d(g):d(s)}catch{d(g)}finally{u(!1)}},P=async(s,a)=>{try{if(!h){p(!0);return}(await k(s,{method:"stripe",amount:a,transactionId:`temp_${Date.now()}`})).data?(x.success("Compra realizada com sucesso!"),f(c=>({...c,[s]:!0}))):x.error("Erro ao processar compra")}catch{x.error("Erro ao processar compra")}};r.useEffect(()=>{(async()=>{if(!h||i.length===0)return;const a=await Promise.all(i.map(async t=>{const c=await S(t.id);return[t.id,!!(c!=null&&c.data)]}));f(Object.fromEntries(a))})()},[h,i]);const o=i.filter(s=>{const a=s.title.toLowerCase().includes(m.toLowerCase())||s.description.toLowerCase().includes(m.toLowerCase()),t=!l||l==="all"||s.category_name===l;return a&&t});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Z,{title:"E-books - Chef do Cotidiano",description:"Compre e-books exclusivos de culinária para elevar suas habilidades na cozinha.",image:"https://images.unsplash.com/photo-1507842217343-583bb7270b66?w=1200&h=630&fit=crop"}),e.jsx("section",{className:"bg-gradient-to-r from-primary to-primary/80 text-primary-foreground py-16",children:e.jsxs("div",{className:"container mx-auto px-4 text-center",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:"E-books de Culinária"}),e.jsx("p",{className:"text-xl mb-8 max-w-2xl mx-auto",children:"Conteúdo premium, receitas exclusivas e técnicas profissionais em formato PDF."}),e.jsx(n,{size:"lg",variant:"secondary",children:"Explorar E-books"})]})}),e.jsx("section",{className:"py-8 border-b",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsx(D,{placeholder:"Buscar e-books...",value:m,onChange:s=>w(s.target.value),className:"max-w-md"})}),e.jsx("div",{className:"flex gap-4",children:e.jsxs($,{value:l,onValueChange:C,children:[e.jsx(V,{className:"w-48",children:e.jsx(q,{placeholder:"Todas as categorias"})}),e.jsxs(G,{children:[e.jsx(b,{value:"all",children:"Todas as categorias"}),y.map(s=>e.jsx(b,{value:s.name,children:s.name},s.id))]})]})})]})})}),e.jsx("section",{className:"py-12",children:e.jsx("div",{className:"container mx-auto px-4",children:v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{role:"status","aria-label":"Carregando",className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between items-center mb-8",children:e.jsxs("h2",{className:"text-2xl font-bold",children:[o.length," e-book",o.length!==1?"s":""," encontrado",o.length!==1?"s":""]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:o.map(s=>{var a;return e.jsxs(B,{className:"overflow-hidden hover:shadow-xl transition-shadow group",children:[e.jsxs("div",{className:"relative",children:[e.jsx(K,{src:s.cover_image,alt:s.title,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx(j,{variant:"secondary",children:s.category_name})}),e.jsx("div",{className:"absolute bottom-4 left-4",children:e.jsxs(j,{className:"bg-green-600 text-white",children:["R$ ",(a=s.price)==null?void 0:a.toFixed(2)]})})]}),e.jsxs(O,{children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx(F,{className:"text-xl group-hover:text-primary transition-colors",children:s.title}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Q,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"text-sm font-medium",children:s.rating||"4.8"})]})]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s.description})]}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.pages||100," páginas"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx("span",{children:"PDF"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{className:"flex-1",asChild:!0,children:e.jsx(T,{to:`/ebooks/${s.id}`,children:"Detalhes"})}),L[s.id]?s.file_url?e.jsx("a",{className:"inline-flex items-center px-4 py-2 border rounded-md",href:s.file_url,target:"_blank",rel:"noreferrer",children:"Baixar"}):e.jsx(n,{variant:"outline",disabled:!0,children:"Já comprado"}):e.jsx(n,{variant:"outline",onClick:()=>P(s.id,s.price),children:"Comprar"})]})]})})]},s.id)})}),o.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Nenhum e-book encontrado"}),e.jsx("p",{className:"text-muted-foreground",children:"Tente ajustar os filtros ou buscar por outros termos."})]})]})})}),e.jsx(A,{isOpen:E,onClose:()=>p(!1)})]})};export{de as EbooksPage,de as default};
