import{j as e}from"./ui-vendor-CCxVMQ9B.js";import{r as n}from"./react-vendor-CN1YoO9o.js";import{b as H,F as w,I as z,B as u,D as V,v as q,w as G,x as M,y as O,z as P,m as J}from"./index-DStP_-PY.js";import{C as K,b as Q,a as W}from"./card-DDJFiqOK.js";import{B as X}from"./badge-B80lkMBr.js";import{S,a as R,b as D,c as _,d as r}from"./select-atrVVbAC.js";import{T as Y,a as Z,b as A,c as t,d as $,e as i}from"./table-CZG2d7nx.js";import{S as ee}from"./search-DyISHBFt.js";import{S as se}from"./square-pen--POmUCjf.js";import"./supabase-vendor-CqT5vMLU.js";import"./utils-vendor-BTGVH9Kg.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=H("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),ue=()=>{var g,C;const[U,j]=n.useState([]),[p,f]=n.useState(!0),[c,L]=n.useState(""),[x,T]=n.useState("all"),[o,d]=n.useState({open:!1,user:null}),[h,m]=n.useState("");n.useEffect(()=>{k()},[]);const k=async()=>{try{f(!0);const{data:s,error:a}=await w.getAll(100,0);if(a)throw a;j(s||[])}catch(s){console.error("Error fetching users:",s)}finally{f(!1)}},B=async()=>{try{const{error:s}=await w.updateRole(o.user.id,h);if(s)throw s;j(a=>a.map(l=>l.id===o.user.id?{...l,role:h}:l)),d({open:!1,user:null}),m("")}catch(s){console.error("Error updating user role:",s)}},E=s=>{m(s.role),d({open:!0,user:s})},v=U.filter(s=>{var N,y,b;const a=((N=s.full_name)==null?void 0:N.toLowerCase().includes(c.toLowerCase()))||((y=s.username)==null?void 0:y.toLowerCase().includes(c.toLowerCase()))||((b=s.email)==null?void 0:b.toLowerCase().includes(c.toLowerCase())),l=x==="all"||s.role===x;return a&&l}),I=s=>{const a={super_admin:{variant:"destructive",label:"Super Admin"},admin:{variant:"default",label:"Admin"},chef:{variant:"secondary",label:"Chef"},user:{variant:"outline",label:"Usuário"}},l=a[s]||a.user;return e.jsx(X,{variant:l.variant,children:l.label})},F=s=>s==="super_admin"||s==="admin"?e.jsx(J,{className:"h-4 w-4 text-red-500"}):s==="chef"?e.jsx(ae,{className:"h-4 w-4 text-blue-500"}):null;return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gerenciar Usuários"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Administre usuários e suas permissões"})]})}),e.jsxs(K,{children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(z,{placeholder:"Buscar usuários...",value:c,onChange:s=>L(s.target.value),className:"pl-10"})]}),e.jsxs(S,{value:x,onValueChange:T,children:[e.jsx(R,{className:"w-48",children:e.jsx(D,{placeholder:"Filtrar por role"})}),e.jsxs(_,{children:[e.jsx(r,{value:"all",children:"Todos os roles"}),e.jsx(r,{value:"user",children:"Usuário"}),e.jsx(r,{value:"chef",children:"Chef"}),e.jsx(r,{value:"admin",children:"Admin"}),e.jsx(r,{value:"super_admin",children:"Super Admin"})]})]})]})}),e.jsxs(W,{children:[p?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(A,{children:[e.jsx(t,{children:"Usuário"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Username"}),e.jsx(t,{children:"Role"}),e.jsx(t,{children:"Criado em"}),e.jsx(t,{children:"Último acesso"}),e.jsx(t,{className:"text-right",children:"Ações"})]})}),e.jsx($,{children:v.map(s=>e.jsxs(A,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:s.avatar_url||"/placeholder-avatar.jpg",alt:s.full_name||"Avatar",className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center space-x-2",children:[e.jsx("span",{children:s.full_name||"Nome não informado"}),F(s.role)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",s.id.slice(0,8),"..."]})]})]})}),e.jsx(i,{children:s.email||"Email não disponível"}),e.jsx(i,{children:s.username||"Não definido"}),e.jsx(i,{children:I(s.role)}),e.jsx(i,{children:new Date(s.created_at).toLocaleDateString("pt-BR")}),e.jsx(i,{children:s.last_sign_in_at?new Date(s.last_sign_in_at).toLocaleDateString("pt-BR"):"Nunca"}),e.jsx(i,{className:"text-right",children:e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>E(s),children:e.jsx(se,{className:"h-4 w-4"})})})]},s.id))})]}),!p&&v.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Nenhum usuário encontrado"})})]})]}),e.jsx(V,{open:o.open,onOpenChange:s=>{d({open:s,user:null}),m("")},children:e.jsxs(q,{children:[e.jsxs(G,{children:[e.jsx(M,{children:"Alterar Role do Usuário"}),e.jsxs(O,{children:['Alterar o role de "',((g=o.user)==null?void 0:g.full_name)||((C=o.user)==null?void 0:C.username),'"']})]}),e.jsx("div",{className:"py-4",children:e.jsxs(S,{value:h,onValueChange:m,children:[e.jsx(R,{children:e.jsx(D,{placeholder:"Selecione um role"})}),e.jsxs(_,{children:[e.jsx(r,{value:"user",children:"Usuário"}),e.jsx(r,{value:"chef",children:"Chef"}),e.jsx(r,{value:"admin",children:"Admin"}),e.jsx(r,{value:"super_admin",children:"Super Admin"})]})]})}),e.jsxs(P,{children:[e.jsx(u,{variant:"outline",onClick:()=>d({open:!1,user:null}),children:"Cancelar"}),e.jsx(u,{onClick:B,disabled:!h,children:"Atualizar Role"})]})]})})]})};export{ue as UsersAdmin};
