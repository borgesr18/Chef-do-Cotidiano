import{j as e}from"./ui-vendor-CCxVMQ9B.js";import{u as K,h as O,r as j}from"./react-vendor-CN1YoO9o.js";import{i as W,r as w,B as u,o as n,I as o,u as p,g as X,s as P}from"./index-DStP_-PY.js";import{C as f,b as v,c as y,a as C}from"./card-DDJFiqOK.js";import{T as q}from"./textarea-CbJGJkAv.js";import{S as I,a as S,b as k,c as F,d as h}from"./select-atrVVbAC.js";import{B as Y}from"./badge-B80lkMBr.js";import{A as Z}from"./arrow-left-Q-Bd-7NB.js";import{P as D}from"./plus-B7lLGJlf.js";import{T as R}from"./trash-2-Db9KMxbd.js";import"./supabase-vendor-CqT5vMLU.js";import"./utils-vendor-BTGVH9Kg.js";const ue=()=>{const N=K(),{id:x}=O(),d=!!x,[_,g]=j.useState(!1),[T,z]=j.useState([]),[a,l]=j.useState({title:"",slug:"",description:"",prep_time:"",cook_time:"",servings:"",difficulty:"easy",status:"draft",category_id:"",featured_image:"",ingredients:[{name:"",quantity:"",unit:""}],instructions:[""]});j.useEffect(()=>{A(),d&&B()},[x]);const A=async()=>{try{const{data:s}=await W.getAll();z(s||[])}catch(s){console.error("Error fetching categories:",s)}},B=async()=>{var s,i,r;try{g(!0);const{data:t,error:m}=await w.getById(x);if(m)throw m;t&&l({title:t.title||"",slug:t.slug||"",description:t.description||"",prep_time:((s=t.prep_time)==null?void 0:s.toString())||"",cook_time:((i=t.cook_time)==null?void 0:i.toString())||"",servings:((r=t.servings)==null?void 0:r.toString())||"",difficulty:t.difficulty||"easy",status:t.status||"draft",category_id:t.category_id||"",featured_image:t.featured_image||"",ingredients:t.ingredients||[{name:"",quantity:"",unit:""}],instructions:t.instructions||[""]})}catch(t){console.error("Error fetching recipe:",t)}finally{g(!1)}},c=(s,i)=>{l(r=>({...r,[s]:i})),s==="title"&&!d&&l(r=>({...r,slug:X(i)}))},b=(s,i,r)=>{const t=[...a.ingredients];t[s]={...t[s],[i]:r},l(m=>({...m,ingredients:t}))},L=()=>{l(s=>({...s,ingredients:[...s.ingredients,{name:"",quantity:"",unit:""}]}))},U=s=>{a.ingredients.length>1&&l(i=>({...i,ingredients:i.ingredients.filter((r,t)=>t!==s)}))},V=(s,i)=>{const r=[...a.instructions];r[s]=i,l(t=>({...t,instructions:r}))},$=()=>{l(s=>({...s,instructions:[...s.instructions,""]}))},M=s=>{a.instructions.length>1&&l(i=>({...i,instructions:i.instructions.filter((r,t)=>t!==s)}))},H=async s=>{const i=s.target.files[0];if(i)try{g(!0);const r=i.name.split(".").pop(),m=`recipes/${`${Date.now()}.${r}`}`,{error:E}=await P.storage.from("images").upload(m,i);if(E)throw E;const{data:{publicUrl:G}}=P.storage.from("images").getPublicUrl(m);l(J=>({...J,featured_image:G})),p.success("Imagem enviada com sucesso!")}catch(r){console.error("Error uploading image:",r),p.error("Erro ao enviar imagem")}finally{g(!1)}},Q=async s=>{s.preventDefault();try{g(!0);const i={...a,prep_time:parseInt(a.prep_time)||0,cook_time:parseInt(a.cook_time)||0,servings:parseInt(a.servings)||1,total_time:(parseInt(a.prep_time)||0)+(parseInt(a.cook_time)||0)};let r;if(d?r=await w.update(x,i):r=await w.create(i),r.error)throw r.error;p.success(`Receita ${d?"atualizada":"criada"} com sucesso!`),N("/admin/recipes")}catch(i){console.error("Error saving recipe:",i),p.error("Erro ao salvar receita")}finally{g(!1)}};return _&&d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs(u,{variant:"ghost",onClick:()=>N("/admin/recipes"),className:"mr-4",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Voltar"]}),e.jsx("h1",{className:"text-3xl font-bold",children:d?"Editar Receita":"Nova Receita"})]}),e.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[e.jsxs(f,{children:[e.jsx(v,{children:e.jsx(y,{children:"Informações Básicas"})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"title",children:"Título *"}),e.jsx(o,{id:"title",value:a.title,onChange:s=>c("title",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"slug",children:"Slug"}),e.jsx(o,{id:"slug",value:a.slug,onChange:s=>c("slug",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"Descrição *"}),e.jsx(q,{id:"description",value:a.description,onChange:s=>c("description",s.target.value),rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"prep_time",children:"Tempo de Preparo (min)"}),e.jsx(o,{id:"prep_time",type:"number",value:a.prep_time,onChange:s=>c("prep_time",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"cook_time",children:"Tempo de Cozimento (min)"}),e.jsx(o,{id:"cook_time",type:"number",value:a.cook_time,onChange:s=>c("cook_time",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"servings",children:"Porções"}),e.jsx(o,{id:"servings",type:"number",value:a.servings,onChange:s=>c("servings",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"difficulty",children:"Dificuldade"}),e.jsxs(I,{value:a.difficulty,onValueChange:s=>c("difficulty",s),children:[e.jsx(S,{children:e.jsx(k,{})}),e.jsxs(F,{children:[e.jsx(h,{value:"easy",children:"Fácil"}),e.jsx(h,{value:"medium",children:"Médio"}),e.jsx(h,{value:"hard",children:"Difícil"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"category",children:"Categoria"}),e.jsxs(I,{value:a.category_id,onValueChange:s=>c("category_id",s),children:[e.jsx(S,{children:e.jsx(k,{placeholder:"Selecione uma categoria"})}),e.jsx(F,{children:T.map(s=>e.jsx(h,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"status",children:"Status"}),e.jsxs(I,{value:a.status,onValueChange:s=>c("status",s),children:[e.jsx(S,{children:e.jsx(k,{})}),e.jsxs(F,{children:[e.jsx(h,{value:"draft",children:"Rascunho"}),e.jsx(h,{value:"published",children:"Publicado"}),e.jsx(h,{value:"archived",children:"Arquivado"})]})]})]})]})]})]}),e.jsxs(f,{children:[e.jsx(v,{children:e.jsx(y,{children:"Imagem em Destaque"})}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"image-upload",children:"Upload de Imagem"}),e.jsx(o,{id:"image-upload",type:"file",accept:"image/*",onChange:H,className:"cursor-pointer"})]}),a.featured_image&&e.jsx("div",{children:e.jsx("img",{src:a.featured_image,alt:"Preview",className:"w-32 h-32 object-cover rounded-lg"})}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"image-url",children:"URL da Imagem"}),e.jsx(o,{id:"image-url",value:a.featured_image,onChange:s=>c("featured_image",s.target.value),placeholder:"https://exemplo.com/imagem.jpg"})]})]})})]}),e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(y,{children:"Ingredientes"}),e.jsxs(u,{type:"button",onClick:L,size:"sm",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Adicionar"]})]})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-3",children:a.ingredients.map((s,i)=>e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(n,{children:"Ingrediente"}),e.jsx(o,{value:s.name,onChange:r=>b(i,"name",r.target.value),placeholder:"Ex: Farinha de trigo"})]}),e.jsxs("div",{className:"w-24",children:[e.jsx(n,{children:"Quantidade"}),e.jsx(o,{value:s.quantity,onChange:r=>b(i,"quantity",r.target.value),placeholder:"2"})]}),e.jsxs("div",{className:"w-24",children:[e.jsx(n,{children:"Unidade"}),e.jsx(o,{value:s.unit,onChange:r=>b(i,"unit",r.target.value),placeholder:"xícara"})]}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>U(i),disabled:a.ingredients.length===1,children:e.jsx(R,{className:"h-4 w-4"})})]},i))})})]}),e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(y,{children:"Modo de Preparo"}),e.jsxs(u,{type:"button",onClick:$,size:"sm",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Adicionar Passo"]})]})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-3",children:a.instructions.map((s,i)=>e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(Y,{variant:"outline",className:"mt-2 min-w-8 justify-center",children:i+1}),e.jsx(q,{value:s,onChange:r=>V(i,r.target.value),placeholder:`Passo ${i+1}...`,rows:2,className:"flex-1"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>M(i),disabled:a.instructions.length===1,className:"mt-2",children:e.jsx(R,{className:"h-4 w-4"})})]},i))})})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>N("/admin/recipes"),children:"Cancelar"}),e.jsxs(u,{type:"submit",disabled:_,children:[_?"Salvando...":d?"Atualizar":"Criar"," Receita"]})]})]})]})};export{ue as RecipeForm};
